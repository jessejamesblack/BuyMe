delimiter //
CREATE TRIGGER alertTrigger AFTER INSERT ON Auction
	FOR EACH ROW
    	BEGIN
		IF (NEW.item_class, NEW.item_manufacturer, NEW.item_name) IN(SELECT item_class, item_manufacturer, item_name FROM Alert)
        THEN UPDATE Alert SET Alert.alert_triggered = 1 WHERE item_class = NEW.item_class AND item_manufacturer = NEW.item_manufacturer AND item_name = NEW.item_name;
		END IF;
	END;//
delimiter //



delimiter //
CREATE TRIGGER alertTrigger2 AFTER INSERT ON Alert
	FOR EACH ROW
    BEGIN
		IF EXISTS(SELECT * FROM Auction WHERE item_class = NEW.item_class AND item_manufacturer = NEW.item_manufacturer AND item_name = NEW.item_name)
        THEN INSERT INTO Email(`from`, `to`, subject, date_time, content) VALUES('admin', NEW.user, 'Alert Warning', NOW(), CONCAT(CONVERT(NEW.alert_number, CHAR), ": This alert is for an auction that already exists."));
        END IF;
	END;//
delimiter //





delimiter //
CREATE TRIGGER warning BEFORE INSERT ON Auction
	FOR EACH ROW
	BEGIN
		IF ((NEW.init_price > NEW.reserve) AND NEW.reserve <> 0) OR (NEW.init_price < 0) OR (NEW.date_time_close < NOW())
        THEN INSERT INTO Warning(item_name, seller_name) VALUES(NEW.item_name, NEW.seller_name);
        END IF;
	END;//
delimiter //
